// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Website {
  id       String    @id @default(uuid())
  domain   String    @unique
  sessions Session[]
  pages    Page[]

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  viewDatas ViewData[]
}

model Session {
  id     String  @id @default(uuid())
  ip     String  @unique
  online Boolean

  browser String?
  os      String?
  device  String?
  country String?

  wid       String
  website   Website    @relation(fields: [wid], references: [id])
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  viewData  ViewData[]

  @@unique(fields: [ip, browser, os], name: "unique_user")
}

model Page {
  id        String     @id @default(uuid())
  pathname  String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  viewData  ViewData[]
  wid       String
  website   Website    @relation(fields: [wid], references: [id])
}

model ViewData {
  id      String  @id @default(uuid())
  viewer  Session @relation(fields: [sessionId], references: [id])
  page    Page    @relation(fields: [pageId], references: [id])
  wid     String
  website Website @relation(fields: [wid], references: [id])

  sessionId String
  pageId    String
  duration  Int
  count     Int
  referrer  String?
  language  String?
  screen    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  browser String?
  os      String?
  device  String?
  country String?
}
